<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">
  <title>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>

<!-- –®–∞–ø–∫–∞ –∞–¥–º–∏–Ω–∞ -->
<div class="admin-header" style="background: #343a40; color: white; padding: 15px; margin-bottom: 20px;">
  <div class="container" style="display: flex; justify-content: space-between; align-items: center;">
    <div>
      <span style="font-weight: bold;">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç–∞—Ä–æ—Ä–∞</span>
      <span sec:authorize="isAuthenticated()" style="margin-left: 20px;">
        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
      </span>
    </div>
    <div>
      <a href="/admin/products" class="btn btn-light btn-sm" style="margin-right: 10px;">
        ‚Üê –ù–∞–∑–∞–¥ –∫ —Ç–æ–≤–∞—Ä–∞–º
      </a>
      <a href="/logout" class="btn btn-danger btn-sm">
        üö™ –í—ã–π—Ç–∏
      </a>
    </div>
  </div>
</div>

<div class="container mt-4">
  <h1>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</h1>
  <p class="text-muted">ID: <span th:text="${product.id}"></span></p>

  <form th:action="@{/admin/products/update}" th:object="${product}" method="post" class="w-50">

    <input type="hidden" th:field="*{id}">

    <div class="mb-3">
      <label for="name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label>
      <input type="text" th:field="*{name}" class="form-control" id="name" required>
      <div th:if="${#fields.hasErrors('name')}" th:errors="*{name}" class="error-message"></div>
    </div>

    <div class="mb-3">
      <label for="category" class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
      <select th:field="*{categoryId}" class="form-control" id="category" required>
        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é --</option>
        <option th:each="cat : ${categories}"
                th:value="${cat.id}"
                th:text="${cat.name}"
                th:selected="${cat.id == product.categoryId}"></option>
      </select>
    </div>

    <div class="mb-3">
      <label for="brand" class="form-label">–ë—Ä–µ–Ω–¥</label>
      <select th:field="*{brandId}" class="form-control" id="brand" required>
        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –±—Ä–µ–Ω–¥ --</option>
        <option th:each="brand : ${brands}"
                th:value="${brand.id}"
                th:text="${brand.name}"
                th:selected="${brand.id == product.brandId}"></option>
      </select>
    </div>

    <div class="mb-3">
      <label for="price" class="form-label">–¶–µ–Ω–∞ (—Ä—É–±.)</label>
      <div class="input-group">
        <input type="number" th:field="*{price}" class="form-control" id="price"
               step="0.01" min="0" required>
      </div>
      <div th:if="${#fields.hasErrors('price')}" th:errors="*{price}" class="error-message"></div>
    </div>

    <div class="mb-3">
      <label for="description" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
      <textarea th:field="*{description}" class="form-control" id="description" rows="4"
                maxlength="500"></textarea>
      <div th:if="${#fields.hasErrors('description')}" th:errors="*{description}"
           class="error-message"></div>
      <div class="form-text">
        –û—Å—Ç–∞–ª–æ—Å—å —Å–∏–º–≤–æ–ª–æ–≤: <span id="chars-counter">1000</span>
      </div>
    </div>
    <script>
      const textarea = document.getElementById('description');
      const counter = document.getElementById('chars-counter');

      textarea.addEventListener('input', function() {
          const remaining = 1000 - this.value.length;
          counter.textContent = remaining;
          counter.style.color = remaining < 50 ? 'red' : 'green';
      });
    </script>

    <div class="mb-3">
      <label for="stock" class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ</label>
      <input type="number" th:field="*{stock}" class="form-control" id="stock" min="0" required>
      <div class="form-text">
        <span th:if="${product.stock == 0}" style="color: red;">–¢–æ–≤–∞—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞ —Å–∫–ª–∞–¥–µ</span>
        <span th:if="${product.stock > 0 and product.stock < 10}" style="color: orange;">–û—Å—Ç–∞–ª–æ—Å—å –º–∞–ª–æ —Ç–æ–≤–∞—Ä–∞</span>
        <span th:if="${product.stock >= 10}" style="color: green;">–¢–æ–≤–∞—Ä –≤ –Ω–∞–ª–∏—á–∏–∏</span>
      </div>
    </div>

    <div class="mb-3">
      <button type="submit" class="btn btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
      <a th:href="@{/admin/products}" class="btn btn-secondary ms-2">–û—Ç–º–µ–Ω–∞</a>
    </div>
  </form>
</div>

</body>
</html>