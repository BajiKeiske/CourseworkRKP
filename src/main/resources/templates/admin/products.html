<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</title>
    <link rel="stylesheet" href="/css/style.css">

</head>
<body>

<!-- –®–∞–ø–∫–∞ –∞–¥–º–∏–Ω–∞ -->
<div class="admin-header">
    <div class="container header-content">
        <div>
            <h3 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
                <small style="opacity: 0.8; font-size: 14px;" sec:authorize="isAuthenticated()">
                    | <span sec:authentication="name"></span>
                </small>
            </h3>
        </div>
        <div>
<!--            <a href="/user/products/catalog" class="btn btn-outline-light btn-sm" style="margin-right: 10px;">-->
<!--                üõçÔ∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞–∫ –ø–æ–∫—É–ø–∞—Ç–µ–ª—å-->
<!--            </a>-->
            <a href="/logout" class="btn btn-outline-danger btn-sm">
                üö™ –í—ã–π—Ç–∏
            </a>
        </div>
    </div>
</div>

<div class="container">
    <h1>üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h1>

    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
    <div class="admin-actions">
        <a th:href="@{/admin/products/create}" class="btn btn-primary">
            ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
        </a>
        <a th:href="@{/admin/categories}" class="btn btn-secondary">
            –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
        </a>
        <a th:href="@{/admin/brands}" class="btn btn-secondary">
            –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–µ–Ω–¥–∞–º–∏
        </a>
    </div>

    <!-- –ü–æ–∏—Å–∫ -->
    <div class="search-form">
        <h4>–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤</h4>
        <form th:action="@{/admin/products/search}" method="get" class="search-grid">
            <input type="text" name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" class="form-control">
            <input type="text" name="brand" placeholder="–ë—Ä–µ–Ω–¥" class="form-control">
            <input type="number" name="maxPrice" placeholder="–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞" class="form-control" step="0.01">
            <button type="submit" class="btn btn-primary">–ù–∞–π—Ç–∏</button>
            <a th:href="@{/admin/products}" class="btn btn-outline-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
        </form>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
    <div class="table-responsive">
        <table class="table table-hover">
            <thead>
            <tr>
                <th>ID</th>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th>–¶–µ–Ω–∞</th>
                <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                <th>–ù–∞ —Å–∫–ª–∞–¥–µ</th>
                <th>–ë—Ä–µ–Ω–¥</th>
                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                <th style="min-width: 220px;">–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="product : ${products}">
                <td th:text="${product.id}"></td>
                <td>
                    <a th:href="@{/products/details/{id}(id=${product.id})}"
                       style="text-decoration: none; color: #007bff; font-weight: 500;">
                        <span th:text="${product.name}"></span>
                    </a>
                </td>
                <td th:text="${#numbers.formatDecimal(product.price, 0, 2)} + ' —Ä—É–±.'"></td>
                <td th:text="${#strings.abbreviate(product.description, 60)}"></td>
                <td>
                    <span th:class="${product.stock == 0} ? 'stock-out' :
                                   (${product.stock < 10} ? 'stock-low' : 'stock-ok')"
                          th:text="${product.stock} + ' —à—Ç.'">
                    </span>
                </td>
                <td th:text="${product.brand?.name} ?: '‚Äî'"></td>
                <td th:text="${product.category?.name} ?: '‚Äî'"></td>
                <td>
                    <div class="btn-group">
                        <a th:href="@{/admin/products/details/{id}(id=${product.id})}"
                           class="btn btn-info btn-sm">
                            –ü—Ä–æ—Å–º–æ—Ç—Ä
                        </a>
                        <a th:href="@{/admin/products/update/{id}(id=${product.id})}"
                           class="btn btn-warning btn-sm">
                            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </a>
                        <form th:action="@{/admin/products/delete/{id}(id=${product.id})}"
                              method="post"
                              style="display: inline;"
                              class="delete-form"
                              th:data-product-name="${product.name}"
                              onsubmit="return confirmDelete(this);">
                            <button type="submit" class="btn btn-danger btn-sm">
                                –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<!--    <div class="alert alert-light mt-4">-->
<!--        <strong>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong>-->
<!--        –í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤: <span th:text="${#lists.size(products)}"></span> |-->
<!--        –ù–∞ —Å–∫–ª–∞–¥–µ: <span th:text="${products.?[stock > 0].size()}"></span> |-->
<!--        –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏: <span th:text="${products.?[stock == 0].size()}"></span>-->
<!--    </div>-->
</div>

<script>
    function confirmDelete(form) {
        var productName = form.getAttribute('data-product-name');
        return confirm('–¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä ¬´' + productName + '¬ª?');
    }
</script>
</body>
</html>